<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0063)http://dl.dropbox.com/u/19508576/signals/pyladies-workshop.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)</title>
<!-- metadata -->
<meta name="generator" content="S5">
<meta name="version" content="S5 1.1">
<meta name="presdate" content="20110418">
<meta name="author" content="Katharine Jarmul">
<meta name="company" content="Loud3r">
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow">
<meta name="controlVis" content="hidden">
<!-- style sheet links -->
<link rel="stylesheet" href="./Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)_files/code.css" type="text/css">
<link rel="stylesheet" href="./Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)_files/slides.css" type="text/css" media="screen" id="slideProj">
<link rel="stylesheet" href="./Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)_files/pretty.css" type="text/css" media="projection" id="slideProj">
<link rel="stylesheet" href="./Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)_files/outline.css" type="text/css" media="screen" id="outlineStyle" disabled="">
<link rel="stylesheet" href="./Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)_files/print.css" type="text/css" media="print" id="slidePrint">
<link rel="stylesheet" href="./Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)_files/opera.css" type="text/css" media="projection" id="operaFix">
<!-- S5 JS -->
<script src="./Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)_files/slides.js" type="text/javascript"></script>
<style media="screen, projection" id="s5ss">body {font-size: 28px !important;}</style></head>
<body>

<div class="layout">
<div id="controls"><form action="http://dl.dropbox.com/u/19508576/signals/pyladies-workshop.html#" id="controlForm" onmouseover="showHide(&#39;s&#39;);" onmouseout="showHide(&#39;h&#39;);"><div id="navLinks" class="hideme" style="visibility: visible; "><a accesskey="t" id="toggle" href="javascript:toggle();">Ø</a><a accesskey="z" id="prev" href="javascript:go(-1);">«</a><a accesskey="x" id="next" href="javascript:go(1);">»</a><div id="navList"><select id="jumplist" onchange="go(&#39;j&#39;);"><option value="0">0 : Scraping the Web with Python</option><option value="1">1 : Overview</option><option value="2">2 : Why Scrape the Web</option><option value="3">3 : Why Use Python?</option><option value="4">4 : Let's Open a Web Page</option><option value="5">5 : WAIT!! What are we DOING?</option><option value="6">6 : urllib/urllib2 POP QUIZ (keep those terminals open!)</option><option value="7">7 : Review: urllib/urllib2 are a GREAT starting points</option><option value="8">8 : Let's get more complex...</option><option value="9">9 : Let's look at what web pages are MADE OF...</option><option value="10">10 : LXML: Intro to your new friend</option><option value="11">11 : Isolating areas of a page</option><option value="12">12 : WAIT!! What are we DOING?</option><option value="13">13 : Let's get specific-al</option><option value="14">14 : Parsing and sorting what we find</option><option value="15">15 : Hmmm.</option><option value="16">16 : Writing a message</option><option value="17">17 : Emailing what you found</option><option value="18">18 : Let's run it all from the top!</option><option value="19">19 : A note on limitations</option><option value="20">20 : But, even with limitations, there's TONS you can do</option><option value="21">21 : Questions???</option><option value="22">22 : Read more</option></select></div></div></form></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer">
<h1>5/15/2011</h1>
<h2>Scraping the Web with Python (OR how I get my happy hour specials delivered to my Inbox)</h2>
</div>

</div>


<div class="presentation">

<div class="slide" id="slide0">
<h1>Scraping the Web with Python</h1>
<h2>(OR... how I get my happy hour specials delivered to my Inbox)</h2>
<h3>Katharine Jarmul &amp; Esther Nam</h3>
<h4>@kjam &amp; @estherbester</h4>
</div>


<div class="slide" id="slide1">
<h1>Overview</h1>
<ul class="">
<li class="">Why scrape the Web with Python</li>
<li class="">Simple page reading (urllib2)</li>
<li class="">More complex scraping (lxml)</li>
<li class="">Common hangups</li>
<li class="">Email with python</li>
</ul>
</div>


<div class="slide" id="slide2">
<h1>Why Scrape the Web</h1>
<ul class="">
<li class="">Informative</li>
<li class="">Super fun</li>
<li class="">VAST source of information</li>
<li class="">Content is king</li>
</ul>
</div>

<div class="slide" id="slide3">
<h1>Why Use Python?</h1>
<ul class="">
<li class="">Scripting languages RULE THE WEB. (no, really)</li>
<li class="">Dynamic</li>
<li class="">Many useful libs, modules, tools, examples</li>
<li class="">Constantly growing source of open-source tools (Hey, you should open source <em>your</em> tool once you build it!)</li>
</ul>
</div>


<div class="slide" id="slide4">
<h1>Let's Open a Web Page</h1>
<pre><span class="kn">import</span> <span class="nn">urllib2</span>

<span class="k">def</span> <span class="nf">get_site_html</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">source</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">get_site_html</span><span class="p">(</span><span class="n">'http://google.com'</span><span class="p">)</span>
</pre>
</div>



<div class="slide" id="slide5">
<h1>WAIT!! What are we DOING?</h1>
<ul class="">
<li class="">Read the dox, they are SUPER helpful: http://docs.python.org/library/urllib2.html</li>
<li class="">Whenever we explore new libraries, let's do some iPython (or python, interaction)</li>
<li class="">Fire up a terminal!   &gt;:)</li>
</ul>
</div>

<div class="slide" id="slide6">
<h1>urllib/urllib2 POP QUIZ (keep those terminals open!)</h1>
<ul class="">
<li class="">Is the word 'python' on the pyladies homepage (http://pyladies.com)?</li>
<li class="">Does google.com have an image? (hint: img tag!)</li>
<li class="">What are the first 10 characters on python.org?</li>
<li class="">Bonus: Find your name on a web page!</li>
</ul>
</div>

<div class="slide" id="slide7">
<h1>Review: urllib/urllib2 are a GREAT starting points</h1>
<ul class="">
<li class="">Easily read HTML pages</li>
<li class="">Test for the presence of elements</li>
<li class="">Read JSON (usually put it though simplejson as well)</li>
<li class="">Great for APIs</li>
</ul>
</div>

<div class="slide" id="slide8">
<h1>Let's get more complex...</h1>
<ul class="">
<li class="">I want to use the web to look for something specific! I don't care what's on python.org!</li>
<li class="">More advanced libraries</li>
<ul class="">
<li class="">BeautifulSoup</li>
<li class="">html5lib</li>
<li class="">lxml</li>
<ul class="">
</ul>
</ul></ul></div>



<div class="slide" id="slide9">
<h1>Let's look at what web pages are MADE OF...</h1>
<ul class="">
<li class="">HTML / CSS are your best friends</li>
<li class="">Firebug is your best weapon</li>
<li class="">Let's investigate... </li>
<li class="">Who doesn't like happy hours? (let's visit http://downtownla.com &gt; Happy Hours)</li>
</ul>
</div>





<div class="slide" id="slide10">
<h1>LXML: Intro to your new friend</h1>
<ul class="">
<li class="">http://lxml.de/index.html</li>
<li class="">lxml.html</li>
<ul class="">
<li class="">css_select</li>
<li class="">find_class</li>
<li class="">text_content</li>
<li class="">clean_html</li>
</ul></ul>
</div>





<div class="slide" id="slide11">
<h1>Isolating areas of a page</h1>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">get_all_tags</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">get_site_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">document_fromstring</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">cssselect</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># First, I'm going to identify the areas of the page I want to look at</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">get_all_tags</span><span class="p">(</span>
                <span class="s">'http://www.downtownla.com/3_10_happyHours.asp?action=ALL'</span><span class="p">,</span>
                <span class="s">'table table div table td'</span><span class="p">)</span>

</pre></div>
</div>


<div class="slide" id="slide12">
<h1>WAIT!! What are we DOING?</h1>
<ul class="">
<li class="">Whenever we explore new libraries, let's do some iPython (or python, interaction)</li>
<li class="">Fire up a terminal!   &gt;:)</li>
</ul>
</div>

<div class="slide" id="slide13">
<h1>Let's get specific-al</h1>
<div class="highlight"><pre>    <span class="n">found_happy_hours</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># Then, I'm going to sort out the *exact* parts of the page </span>
    <span class="c"># that match what I'm looking for...</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">cssselect</span><span class="p">(</span><span class="s">'p.calendar_EventTitle'</span><span class="p">):</span>
            <span class="n">found_happy_hours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">text_content</span><span class="p">())</span>
</pre></div>
</div>


<div class="slide" id="slide14">
<h1>Parsing and sorting what we find</h1>
<div class="highlight"><pre>    <span class="c"># Now I'm going to loop through the food I like </span>
    <span class="c"># and see if any of the happy hour descriptions match</span>
    <span class="k">for</span> <span class="n">food</span> <span class="ow">in</span> <span class="n">stuff_i_like</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">hh</span> <span class="ow">in</span> <span class="n">found_happy_hours</span><span class="p">:</span>
            <span class="c"># checking for text AND making sure I don't have duplicates</span>
            <span class="k">if</span> <span class="n">food</span> <span class="ow">in</span> <span class="n">hh</span> <span class="ow">and</span> <span class="n">hh</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">my_happy_hours</span><span class="p">:</span> 
                <span class="k">print</span> <span class="s">"YAY! I found some </span><span class="si">%s</span><span class="s">!"</span> <span class="o">%</span> <span class="n">food</span>
                <span class="n">my_happy_hours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hh</span><span class="p">)</span>
</pre></div>
</div>

<div class="slide" id="slide15">
<h1>Hmmm.</h1>
<ul class="">
<li class="">That's all good and great, but I don't want to run this every day!</li>
<li class="">Might as well go to the web page and use Cntl + F, GOOD JOB LADIES (eyeroll)</li>
<li class="">FEAR NOT!!!</li>
</ul>
</div>


<div class="slide" id="slide16">
<h1>Writing a message</h1>
<div class="highlight"><pre>    <span class="c">#Now, let's make a mail message we can read:</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s">'Hey Katharine,</span><span class="se">\n\n\n</span><span class="s">'</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">'OMG, I found some stuff for you in Downtown, take a look.</span><span class="se">\n\n</span><span class="s">'</span> 
    <span class="n">message</span> <span class="o">+=</span> <span class="s">'==============================</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">my_happy_hours</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> 
    <span class="c"># To read more about encoding:</span>
    <span class="c"># http://diveintopython.org/xml_processing/unicode.html</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\r</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">'</span><span class="se">\n\n</span><span class="s">XOXO,</span><span class="se">\n</span><span class="s"> Your Py Script'</span>
</pre></div>
</div>

<div class="slide" id="slide17">
<h1>Emailing what you found</h1>
<div class="highlight"><pre>    <span class="c">#And email it to ourselves!</span>
    <span class="n">email</span> <span class="o">=</span> <span class="s">'katharine@pyladies.com'</span>
    <span class="n">send_email</span><span class="p">(</span><span class="s">'Happy Hour Update'</span><span class="p">,</span><span class="n">message</span><span class="p">,</span> 
                <span class="n">from_addr</span><span class="o">=</span><span class="n">GMAIL_LOGIN</span><span class="p">,</span> <span class="n">to_addr</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>

</pre></div>
</div>

<div class="slide" id="slide18">
<h1>Let's run it all from the top!</h1>
<ul class="">
<li class="">Put in your email...</li>
<li class="">python scraper.py</li>
</ul>
</div>

<div class="slide" id="slide19">
<h1>A note on limitations</h1>
<ul class="">
<li class="">A lot of the web is broken (sad face...)</li>
<li class="">Although there are *many* helpers, sometimes there are no patterns</li>
<li class="">Sites change, move, go offline</li>
<li class="">Steve Jobs is right about one thing: Flash is evil</li>
</ul>
</div>



<div class="slide" id="slide20">
<h1>But, even with limitations, there's TONS you can do</h1>
<ul class="">
<li class="">Build HTML, XML, JSON from data</li>
<li class="">So many APIS!!!</li>
<li class="">Mechanize can help with complex user-agents / behaviors</li>
<li class="">Automate web tasks</li>
</ul>
</div>


<div class="slide" id="slide21">
<h1>Questions???</h1>
<ul class="">
<li class="">If not... let's work on some scraper ideas you have!</li>
</ul>
</div>


<div class="slide" id="slide22">
<h1>Read more</h1>
<li>Tutorials</li>
<ul>
<li>http://www.asheesh.org/note/preso/pycon09-scraping-fun.html</li>
<li>http://diveintopython3.org/xml.html</li>
<li>http://www.goldb.org/pythonwebscraping.html</li>
</ul>
<li>Dox</li>
<ul>
<li>http://docs.python.org/library/urllib2.html &amp; http://lxml.de/</li>
<li>http://wwwsearch.sourceforge.net/mechanize/</li>
<li>http://code.google.com/p/html5lib/</li>
<li>http://scrapy.org/</li>
</ul>
</div>





</div>



</body></html>